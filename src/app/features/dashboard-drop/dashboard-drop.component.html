<mat-tab-group *ngIf="categories.length">
  <mat-tab *ngFor="let category of categories" [label]="category.name">

    <ng-template mat-tab-label>
      <div class="custom-tab-label-wrapper">
        <span class="category-name">{{ category.name }}</span>
        <i
          class="bi bi-three-dots-vertical tab-menu-trigger"
          [matMenuTriggerFor]="tabMenu"
          (click)="$event.stopPropagation()"
        ></i>
      </div>
    </ng-template>

    <mat-menu #tabMenu="matMenu">
      <button mat-menu-item><i class="bi bi-pencil"></i> Edit Category</button>
      <button mat-menu-item><i class="bi bi-pencil-square"></i> Manage Categories</button>
      <button mat-menu-item> <i class="bi bi-x-lg"></i> Delete Category</button>
    </mat-menu>

  <div
     cdkDropList
     cdkDropListOrientation="mixed"
     class="group-list"
     (cdkDropListDropped)="dropGroup($event, category)"
     >
     @for (group of category.groups; track group.id) {
     <div class="group-box" cdkDrag [cdkDragDisabled]="isGroupDraggable">
        <div class="group-header d-flex align-items-center justify-content-between">
           <i
           class="bi bi-list group-drag-handle"
           cdkDragHandle
           title="Drag group"
           (mouseover)="allowGroupDrag()"
           (mouseout)="preventGroupDrag()"
           ></i>
           <div class="group-name-container d-flex align-items-center" #groupNameContainer>
              <div class="group-name">{{ group.name }}</div>
           </div>
           <i class="bi bi-three-dots-vertical group-menu-icon" [matMenuTriggerFor]="groupMenu"></i>
           <mat-menu #groupMenu="matMenu">
            <button mat-menu-item (click)="openAddLinkDialog(group.id)"><i class="bi bi-plus-lg"></i> Add Link</button>
            <button mat-menu-item (click)="openEditLinksDialog(category.id, group.id)"><i class="bi bi-pencil"></i> Edit Group</button>
            <button mat-menu-item><i class="bi bi-pencil-square"></i> Group Manager</button>
            <button mat-menu-item [matMenuTriggerFor]="moveGroupSubMenu"><i class="bi bi-send"></i> Move Group</button>
            <button mat-menu-item (click)="deleteGroup(group)"><i class="bi bi-x-lg"></i> Delete Group</button>
          </mat-menu>
          <mat-menu #moveGroupSubMenu="matMenu">
            <button
              mat-menu-item
              *ngFor="let category of categories"
              (click)="moveGroupToCategory(group, category.id)"
            >
              {{ category.name }}
            </button>
          </mat-menu>
        </div>
        <div
           class="link-list"
           cdkDropList
           [cdkDropListData]="group.links"
           [cdkDropListConnectedTo]="getConnectedDropLists(category)"
           (cdkDropListDropped)="dropLink($event, group, category)"
           [id]="'group-list-' + group.id"
           >
           @for (link of group.links; track link.id) {
            <div  class="link-item" 
                  cdkDrag 
                  [cdkDragData]="link"
                  [cdkDragDisabled]="isLinkDraggable"
                  
                  >
              <i
                class="bi bi-list link-drag-handle"
                cdkDragHandle
                title="Drag link"
                (mouseover)="allowLinkDrag()"
                (mouseout)="preventLinkDrag()"
              ></i>
              <div class="link-name-container">
                {{ link.name }}
              </div>
              <i class="bi bi-three-dots-vertical link-menu-icon" [matMenuTriggerFor]="linkMenu"></i>
              <mat-menu #linkMenu="matMenu">
                <button mat-menu-item (click)="editLink(link)"><i class="bi bi-pen"></i> Edit Link</button>
                <button mat-menu-item><i class="bi bi-pencil-square"></i> Link Manager</button>
                <button mat-menu-item (click)="deleteLink(link)"><i class="bi bi-x-lg"></i> Delete Link</button>
              </mat-menu>
            </div>
           }
        </div>
     </div>
     }
     <div class="group-box add-group-box static" (click)="openAddGroupDialog(category.id)">
      <div class="group-header d-flex align-items-center justify-content-center">
        <i class="bi bi-plus-circle me-2"></i> Add Group
      </div>
    </div>
  </div>
  </mat-tab>
</mat-tab-group>