<mat-card class="custom-mat-card mt-5" [ngStyle]="{'background-color': cardBackgroundRgba}">

<mat-form-field class="w-100">
  <mat-label>Search</mat-label>

  <input type="text"
       #searchInput
       matInput
       placeholder="Start typing to search or filter."
       [formControl]="searchControl"
       [matAutocomplete]="auto"
       (keydown.enter)="handleEnter()"
       (focus)="onFocus()" />

  <!-- Clear Button (suffix) -->
  <button *ngIf="searchControl.value"
          matSuffix
          mat-icon-button
          aria-label="Clear"
          (click)="clearSearch()">
    <mat-icon>clear</mat-icon>
  </button>

<mat-autocomplete #auto="matAutocomplete" autoActiveFirstOption (optionSelected)="onOptionSelected($event)">
  <!-- üåê External search -->
  <mat-option *ngIf="searchControl.value" [value]="'SEARCH_EXTERNAL'">
    üîç Search {{ searchProviderName }} for "{{ searchControl.value }}" ‚Äî <small class="text-muted">({{ searchProviderName }} Search)</small>
  </mat-option>

  <!-- üîó Link Results Group -->
<mat-optgroup *ngIf="filteredLinks.length > 0" label="Links">
  <mat-option *ngFor="let link of filteredLinks" [value]="link">
    <img [src]="getIconUrl(link.icon)"
         width="24"
         height="24"
         style="margin-right: 8px;"
         (error)="onImageError($event)">
    {{ link.name }} ‚Äî <small class="text-muted"><b>Group:</b>  {{ link.group?.name }}</small>
  </mat-option>
</mat-optgroup>

  <mat-optgroup *ngIf="filteredLists.length > 0" label="Lists">
    <mat-option *ngFor="let list of filteredLists" [value]="list" (click)="onListSelected(list)">
      <i class="bi bi-list-columns-reverse"></i>&nbsp; {{ list.name }} - <small class="text-muted"><b>List</b></small>
    </mat-option>
  </mat-optgroup>

  <mat-optgroup *ngIf="filteredListItems.length > 0" label="List Items">
    <mat-option *ngFor="let item of filteredListItems" [value]="item" (click)="onListItemSelected(item)">
      <i class="bi bi-sticky"></i>&nbsp; {{ item.title }}
      <small *ngIf="item.list?.name" class="text-muted">‚Äî <b>List item in: </b> {{ item.list.name }}</small>
    </mat-option>
  </mat-optgroup>
</mat-autocomplete>



</mat-form-field>

</mat-card>

<!-- Toggle link + Deselect All -->
<div class="mt-3 d-flex justify-content-between align-items-center">
<div
  style="cursor: pointer; color: var(--group-font-color);"
  (click)="showFilterOptions = !showFilterOptions"
  class="text-light d-flex align-items-center"
>
  {{ showFilterOptions ? 'Hide search filter options' : 'Show search filter options' }}
  <i class="bi me-2" [ngClass]="showFilterOptions ? 'bi-chevron-up' : 'bi-chevron-down'" style="margin-left: 6px; position: relative; bottom: -1px;"></i>
</div>

</div>

<!-- Checkboxes -->
<!-- Filter Row with Deselect All aligned right -->
<div
  *ngIf="showFilterOptions"
  class="d-flex justify-content-between align-items-center flex-wrap mt-2"
  style="width: 100%;"
>
  <!-- ‚úÖ Checkboxes container -->
  <div class="d-flex gap-4 align-items-center flex-wrap filter-checkboxes">
    <!-- Link Item Name -->
    <div class="form-check d-flex align-items-center">
      <input type="checkbox" class="form-check-input" id="filterByName" [(ngModel)]="filterByName" />
      <label class="form-check-label ms-2 text-light" for="filterByName">Link Item Name</label>
    </div>

    <!-- Link Item Description -->
    <div class="form-check d-flex align-items-center">
      <input type="checkbox" class="form-check-input" id="filterByDescription" [(ngModel)]="filterByDescription" />
      <label class="form-check-label ms-2 text-light" for="filterByDescription">Link Item Description</label>
    </div>

    <!-- Link Group Name -->
    <div class="form-check d-flex align-items-center">
      <input type="checkbox" class="form-check-input" id="filterByGroup" [(ngModel)]="filterByGroup" />
      <label class="form-check-label ms-2 text-light" for="filterByGroup">Link Group Name</label>
    </div>

    <!-- List Name -->
    <div class="form-check d-flex align-items-center">
      <input type="checkbox" class="form-check-input" id="filterByListName" [(ngModel)]="filterByListName" />
      <label class="form-check-label ms-2 text-light" for="filterByListName">List Name</label>
    </div>

    <!-- List Item -->
    <div class="form-check d-flex align-items-center">
      <input type="checkbox" class="form-check-input" id="filterByListItem" [(ngModel)]="filterByListItem" />
      <label class="form-check-label ms-2 text-light" for="filterByListItem">List Item</label>
    </div>
  </div>

  <!-- ‚úÖ Deselect All text aligned right -->
<div
  class="ms-auto text-light d-flex align-items-center"
  style="cursor: pointer; white-space: nowrap;"
  (click)="toggleAllFilters()"
>
  <i class="bi me-2" [ngClass]="allFiltersSelected ? 'bi-x-lg' : 'bi-check-lg'"></i>
  {{ allFiltersSelected ? 'Deselect All' : 'Select All' }}
</div>
</div>



