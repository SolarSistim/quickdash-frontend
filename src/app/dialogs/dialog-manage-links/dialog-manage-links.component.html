<div class="dialog-flex-container">
  <mat-dialog-content class="dialog-content">
  <h3 mat-dialog-title class="pb-2" *ngIf="!showGroupEditor">Manage Links</h3>
  <h3 mat-dialog-title class="pb-2" *ngIf="showGroupEditor">Edit Group</h3>

  <i class="bi bi-x-lg close-icon" title="Close" (click)="closeDialog()"></i>

  <div class="row">
    <div class="col-lg-6">
      <!-- Select Category -->
      <label>Select Category</label>
      <select class="form-select mb-2" [(ngModel)]="selectedCategoryId" (change)="onCategoryChange()">
        <option *ngFor="let cat of categories" [value]="cat.id">{{ cat.name }}</option>
      </select>
    </div>

    <div class="col-lg-6">
      <!-- Select Group -->
      <label>Select Group</label>
      <select class="form-select mb-3" [(ngModel)]="selectedGroupId" (ngModelChange)="selectedGroupId = +$event; onGroupChange()">
        <option *ngFor="let group of filteredGroups" [value]="group.id">{{ group.name }}</option>
      </select>
    </div>
  </div>

  <!-- Group Name Editor -->
  <div *ngIf="showGroupEditor">
    <label for="groupName">&nbsp;Group Name</label>
    <div class="input-group mb-4 mt-0">
      <input
        autocomplete="off"
        type="text"
        id="groupName"
        class="form-control"
        [(ngModel)]="groupName"
        placeholder="Group Name"
      />
    </div>
  </div>

  <!-- Add New Link Form -->
  <div *ngIf="showAddForm" style="margin-bottom: 20px;">
    <form (ngSubmit)="addLink()">
      <div class="input-group mb-1 mt-2">
        <input autocomplete="off" #linkNameInput type="text" class="form-control" name="newLinkName" placeholder="Display Name" [(ngModel)]="newLinkName" />
        <input autocomplete="off" type="text" class="form-control" name="newLinkUrl" placeholder="URL" [(ngModel)]="newLinkUrl" />
      </div>

      <div class="input-group mb-1 mt-2">
        <input autocomplete="off" type="text" class="form-control" name="newLinkDescription" placeholder="Link Description" [(ngModel)]="newLinkDescription" />
        <button class="btn btn-outline-secondary" type="button" (click)="cancelAddLink()">âœ•</button>
        <button class="btn btn-outline-secondary" type="submit" [disabled]="!newLinkName.trim() || !newLinkUrl.trim()">Add Link</button>
      </div>
    </form>
  </div>

  <!-- Add New Link Button -->
  <div *ngIf="!showAddForm" class="mt-1 mb-3">
    <span style="cursor: pointer;" (click)="showAddForm = true">&nbsp;[+] Add New Link Here</span>
  </div>

  <!-- No Links Message -->
  <div *ngIf="editableLinks.length === 0" class="text-muted mb-3 ps-1">
    No links yet. Click <strong>"Add New Link Here"</strong> to add one.
  </div>

  <!-- Link List -->
  <div cdkDropList (cdkDropListDropped)="drop($event)" style="overflow-y: auto;">
    <div *ngFor="let link of editableLinks" cdkDrag class="category-row" style="display: flex; align-items: center; gap: 10px;">
      
      <span cdkDragHandle><i class="bi bi-list" style="font-size: 1.2rem;"></i></span>

      <div *ngIf="!link.isEditing" style="display: flex; align-items: center; width: 100%;">
        <i class="bi bi-pencil" (click)="enableEdit(link)" style="cursor: pointer; margin-right: 8px;"></i>
        <span>{{ link.name }}</span>
        <span style="flex: 1 1 auto;"></span>
        <i class="bi bi-x-lg" style="color: red; cursor: pointer;" (click)="deleteLink(link)"></i>
      </div>

      <div *ngIf="link.isEditing" class="w-100 mt-2">
        <label for="linkName">&nbsp;Link Name</label>
        <input class="form-control mb-1" autocomplete="off" [(ngModel)]="link.name" placeholder="Name" id="linkName" />
        <label for="linkUrl">&nbsp;Link URL</label>
        <input class="form-control mb-1" autocomplete="off" [(ngModel)]="link.url" placeholder="URL" id="linkUrl" />
        <label for="linkDescription">&nbsp;Link Description</label>
        <div class="input-group mb-2" style="flex-wrap: wrap;">
          <input class="form-control" autocomplete="off" [(ngModel)]="link.description" placeholder="Description" id="linkDescription" />
          <button class="btn btn-outline-secondary" (click)="cancelEdit(link)">Cancel</button>
          <button class="btn btn-outline-secondary" (click)="saveEdit(link)">Save</button>
        </div>
      </div>

    </div>
  </div>

</mat-dialog-content>

  
<mat-dialog-actions class="dialog-actions">
  <button mat-button color="primary" (click)="saveChanges()" [disabled]="isUnchanged">Save</button>
  <button mat-button color="primary" (click)="saveAndClose()" [disabled]="isUnchanged">Save & Close</button>
</mat-dialog-actions>

</div>

  